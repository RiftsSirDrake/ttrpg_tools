<% content_for :page_title, "#{@system.name} System" %>

<div class="container-fluid">
  <% unless @system.blank? %>
    <div class="pagetitle">
      <h1><%= @system.name %> System</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">Home</a></li>
          <li class="breadcrumb-item"><%= link_to "Sectors", sectors_path %></li>
          <li class="breadcrumb-item"><%= link_to @system.sector.name, sector_path(@system.sector) %></li>
          <li class="breadcrumb-item"><%= link_to "Systems", systems_path(sector_id: @system.sector.id) %></li>
          <li class="breadcrumb-item active"><%= @system.name %></li>
        </ol>
      </nav>
    </div>

    <section class="section">
      <div class="row">
        <!-- Main Details Card -->
        <div class="col-lg-8">
          <div class="card">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title">System Overview <span>| <%= @system.location %></span></h5>
                <% advisory_code = @system.advisory.split(':').first.strip %>
                <% badge_class = case advisory_code
                                  when 'Green' then 'bg-success'
                                  when 'Amber' then 'bg-warning'
                                  when 'Red' then 'bg-danger'
                                  else 'bg-secondary'
                                end %>
                <span class="badge <%= badge_class %> fs-6"><%= advisory_code %> Advisory</span>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="row mb-3">
                    <div class="col-sm-5 fw-bold text-primary">Starport</div>
                    <div class="col-sm-7"><%= @system.starport %></div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-sm-5 fw-bold text-primary">Planet Size</div>
                    <div class="col-sm-7"><%= @system.planet_size %></div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-sm-5 fw-bold text-primary">Atmosphere</div>
                    <div class="col-sm-7"><%= @system.atmosphere %></div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-sm-5 fw-bold text-primary">Hydrosphere</div>
                    <div class="col-sm-7"><%= @system.hydrosphere %></div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="row mb-3">
                    <div class="col-sm-5 fw-bold text-primary">Population</div>
                    <div class="col-sm-7"><%= @system.population %></div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-sm-5 fw-bold text-primary">Government</div>
                    <div class="col-sm-7"><%= @system.goverment %></div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-sm-5 fw-bold text-primary">Law Level</div>
                    <div class="col-sm-7"><%= @system.law %></div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-sm-5 fw-bold text-primary">Tech Level</div>
                    <div class="col-sm-7">TL <%= @system.tech_level %></div>
                  </div>
                </div>
              </div>

              <div class="row mt-3 border-top pt-3">
                <div class="col-md-6">
                  <h6 class="fw-bold text-primary">Faction & Bases</h6>
                  <p class="mb-1"><strong>Allegiance:</strong> <%= @system.faction_name || "Independent" %></p>
                  <p class="mb-1 text-muted small"><%= @system.faction_description %></p>
                  <p class="mb-0"><strong>Bases:</strong> <%= @system.bases %></p>
                </div>
                <div class="col-md-6">
                  <h6 class="fw-bold text-primary">Traits & Elements</h6>
                  <p class="mb-1"><strong>Traits:</strong> <%= [@system.notes1, @system.notes2, @system.notes3].reject { |n| n.blank? }.compact.join(', ') %></p>
                  <p class="mb-1"><strong>Asteroid Belts:</strong> <%= @system.asteroid_belts %></p>
                  <p class="mb-0"><strong>Gas Giants:</strong> <%= @system.gas_giants %></p>
                </div>
              </div>
              
              <div class="mt-4 pt-3 border-top">
                <div class="d-flex gap-2">
                  <% if can_edit_systems?(@system.sector, current_user) %>
                    <%= link_to edit_system_path(@system), class: 'btn btn-primary' do %>
                      <i class="bi bi-pencil"></i> Edit System
                    <% end %>
                    <%= link_to system_path(id: @system.id, sector_id: @system.sector.id), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger' do %>
                      <i class="bi bi-trash"></i> Delete
                    <% end %>
                  <% end %>
                  <%= link_to systems_path(sector_id: @system.sector.id), class: 'btn btn-secondary' do %>
                    <i class="bi bi-arrow-left"></i> Back to Systems
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Sidebar / Comparison Card -->
        <div class="col-lg-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Size Comparison</h5>
              <div class="d-flex justify-content-around align-items-end mb-4" style="min-height: 150px;">
                <div class="text-center">
                  <div class="mb-2">
                    <i id="icon1" class="bi bi-globe text-info" data-value="<%= planet_size_int(@system.planet_size) %>"></i>
                  </div>
                  <div class="fw-bold"><%= @system.name %></div>
                  <div class="small text-muted"><%= @system.planet_size.split('-').first %> km</div>
                </div>
                <div class="text-center pb-4">
                  <div class="fw-bold">VS</div>
                </div>
                <div class="text-center">
                  <div class="mb-2">
                    <i id="icon2" class="bi bi-globe text-secondary" data-value="12000"></i>
                  </div>
                  <div class="fw-bold">Earth</div>
                  <div class="small text-muted">12,000 km</div>
                </div>
              </div>
              <div class="alert alert-info py-2 small">
                <i class="bi bi-info-circle me-1"></i> Visual comparison based on diameter.
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Quick Actions</h5>
              <div class="list-group">
                <%= link_to "/hex_system/hexmap?sector_id=#{@system.sector.id}", class: "list-group-item list-group-item-action" do %>
                  <i class="bi bi-grid-3x3 me-2 text-info"></i> View on Hexmap
                <% end %>
                <%= link_to sector_path(@system.sector), class: "list-group-item list-group-item-action" do %>
                  <i class="bi bi-globe me-2 text-primary"></i> Sector Details
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Notes Section -->
      <div id="notes_table" class="row">
        <div class="col-12">
          <%= render partial: 'sector/system_notes/system_notes' %>
        </div>
      </div>
    </section>
  <% end %>
</div>

<script>
  $(document).ready(function() {
    const icon1Val = parseInt($('#icon1').data('value'));
    const icon2Val = parseInt($('#icon2').data('value'));
    const ratio = icon1Val / icon2Val;
    
    // Scale base size of 3em by the ratio
    const baseSize = 3; 
    $('#icon1').css({
      'font-size': (baseSize * ratio) + 'em'
    });
    $('#icon2').css({
      'font-size': baseSize + 'em'
    });
  });
</script>
