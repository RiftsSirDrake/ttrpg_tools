Running 6 tests in a single process (parallelization threshold is 50)
Run options: --seed 26705
# Running:
F
Failure:
SystemNotesVisibilityTest#test_user_without_permission_cannot_see_any_notes_even_if_public [/app/test/integration/system_notes_visibility_test.rb:96]:
Expected /This\ is\ a\ public\ note/ to not match "<!DOCTYPE html>\n<html>\n  <head>\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n    \n    \n    \n    <title>Test System System</title>\n    <link rel=\"icon\" type=\"image/x-icon\" href=\"/assets/cc_icon-42def3142b93d68c0270f2fa6450c6679177027439a88be19974bf6e519dee9d.png\" />\n    \n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css\" />\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css\" />\n    <link rel=\"stylesheet\" href=\"/assets/application-2d842fb1ae2dfe531fd2e10c6c58b9d3432a5f865e7f578303750380984a9817.css\" />\n    \n    <script src=\"/assets/application-bbb3e9df6dfa7fe063dd9baa53a645d88e75f6fa15583986a895fb11f76beb20.js\"></script>\n\n    \n    \n    \n  </head>\n  \n  <body  class='toggle-sidebar' >\n    \n      <!-- ======= Header ======= -->\n  <header id=\"header\" class=\"header fixed-top d-flex align-items-center\">\n  \n      <div class=\"d-flex align-items-center justify-content-between\">\n        <a href=\"/\" class=\"logo d-flex align-items-center\">\n          <img src=\"/assets/cc_icon-42def3142b93d68c0270f2fa6450c6679177027439a88be19974bf6e519dee9d.png\" />\n          <span class=\"d-none d-lg-block\">CosmosCreator</span>\n        </a>\n        <i class=\"bi bi-list toggle-sidebar-btn\"></i>\n      </div><!-- End Logo -->\n  \n      <nav class=\"header-nav ms-auto\">\n        <ul class=\"d-flex align-items-center\">\n  \n          <li class=\"nav-item dropdown pe-3\">\n  \n            <a class=\"nav-link nav-profile d-flex align-items-center pe-0\" href=\"#\" data-bs-toggle=\"dropdown\">\n              <span class=\"d-none d-md-block dropdown-toggle ps-2\">Profile</span>\n            </a>\n  \n            <ul class=\"dropdown-menu dropdown-menu-end dropdown-menu-arrow profile\">\n              <li class=\"dropdown-header\">\n                <h6>two@example.com</h6>\n                <span>Member</span>\n              </li>\n              <li>\n                <hr class=\"dropdown-divider\">\n              </li>\n  \n              <li>\n                <a class=\"dropdown-item d-flex align-items-center\" href=\"/profile\">\n                  <i class=\"bi bi-person\"></i>\n                  <span>My Profile</span>\n</a>              </li>\n              <li>\n                <hr class=\"dropdown-divider\">\n              </li>\n  \n              <li>\n                <form class=\"button_to\" method=\"post\" action=\"/users/sign_out\"><input type=\"hidden\" name=\"_method\" value=\"delete\" autocomplete=\"off\" /><button class=\"dropdown-item d-flex align-items-center\" type=\"submit\">\n                  <i class=\"bi bi-box-arrow-right\"></i>\n                  <span>Sign Out</span>\n</button></form>              </li>\n  \n            </ul>\n          </li>\n  \n        </ul>\n      </nav>\n  \n    </header>\n  \n    <!-- ======= Sidebar ======= -->\n    <aside id=\"sidebar\" class=\"sidebar\">\n  \n      <ul class=\"sidebar-nav\" id=\"sidebar-nav\">\n  \n        <li class=\"nav-item\">\n          <a class=\"nav-link \" href=\"/\">\n            <i class=\"bi bi-grid\"></i>\n            <span>Home</span>\n          </a>\n        </li>\n        \n\n          <li class=\"nav-item\">\n            <a class=\"nav-link collapsed\" data-bs-target=\"#sector-nav\" data-bs-toggle=\"collapse\" href=\"#\">\n              <i class=\"bi bi-menu-button-wide\"></i><span>Sectors</span><i class=\"bi bi-chevron-down ms-auto\"></i>\n            </a>\n            <ul id=\"sector-nav\" class=\"nav-content collapse\" data-bs-parent=\"#sidebar-nav\">\n              <li>\n                <a href=\"/sectors\">\n                  <i class=\"bi bi-circle\"></i><span>Sectors List</span>\n</a>              </li>\n            </ul>\n          </li>\n\n        <li class=\"nav-heading\">Misc</li>\n  \n        <li class=\"nav-item\">\n          <a class=\"nav-link collapsed\" href=\"/profile\">\n            <i class=\"bi bi-person\"></i>\n            <span>Profile</span>\n</a>        </li>\n      </ul>\n  \n    </aside><!-- End Sidebar-->\n\n    \n    <main id=\"main\" class=\"main\">\n      \n<style>\n  thead {\n    position: sticky;\n    inset-block-start: 0; /* \"top\" */\n    background: #eee;\n    border-bottom: 2px solid #ccc;\n  }\n  \n  table {\n    border-collapse: collapse;\n  }\n\n  html {\n    scroll-padding-top: 70px; /* height of sticky header */\n  }\n\n  .card {min-height: 165px}\n\n</style>\n\n  <div class=\"pagetitle\">\n    <h1>Test System <span>| 9999</span></h1>\n    <nav>\n      <ol class=\"breadcrumb\">\n        <li class=\"breadcrumb-item\"><a href=\"/\">Home</a></li>\n        <li class=\"breadcrumb-item\"><a href=\"/sectors\">Sectors</a></li>\n        <li class=\"breadcrumb-item\"><a href=\"/systems?sector_id=980190962\">Systems</a></li>\n        <li class=\"breadcrumb-item\"><a href=\"/hex_system/hexmap?sector_id=980190962\">Hexmap</a></li>\n      </ol>\n    </nav>\n  </div>\n  \n  <section class='section dashboard'>\n    <div id=\"row1\" class='row'>\n      \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Starport <span>| Excellent</span></h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <h6>Refined Fuel, Advanced Repair, Advanced Shipyard</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Planet Size <span>| Asteroid Belt</span></h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"card-icon rounded-circle d-flex flex-column align-items-center justify-content-center mx-5\">\n                  <i id=\"icon1\" class=\"bi bi-globe\" data-value=\"0\"></i>\n                  <h6>Test System</h6>\n                </div>\n                <div class=\"d-flex align-items-center mx-1\">\n                  <h3>VS</h3>\n                </div>\n                <div class=\"card-icon rounded-circle d-flex flex-column align-items-center justify-content-center mx-5\">\n                  <i id=\"icon2\" class=\"bi bi-globe\" data-value=\"12000\"></i>\n                  <h6>Earth</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Environment</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <h6><strong>Atmo:</strong> Vacuum - Requires Vacc Suit</h6>\n                  <h6><strong>Hydro:</strong> Desert World - 5%</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Population</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <h6><strong>Permanent Population:</strong> None</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Society</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>Gov:</strong> No Government Structure</h6>\n                    <h6><strong>Law:</strong> Lawless</h6>\n                    <h6><strong>Tech:</strong> Neolithic</h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Faction</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>Faction: </strong></h6>\n                    <p class=\"text-muted small\"></p>\n                    <h6><strong>Bases: </strong></h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Traits</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6></h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>    \n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>System Elements</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>Asteroid Belts:</strong> 0</h6>\n                    <h6><strong>Gas Giants:</strong> 0</h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>    \n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Travel Advisory</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>None:</strong>  No Major Listed Concerns</h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div> \n\n      <div class=\"btn-group col-lg-6 offset-lg-3\" role=\"group\">\n      </div>\n    \n    </div>\n    \n    <div id=\"notes_table\" class='row py-5'>\n        <div class=\"pagetitle\">\n    <h1>Notes <span>| \n</span></h1>\n  </div>\n  \n    <div class=\"col-12\">\n      <div class=\"card overflow-auto\" style=\"min-height: 50px;\">\n        <div class=\"card-body\">\n          <h5 class=\"card-title\">one <span>| <small>12/24/2025</small></span></h5>\n          This is a public note\n        </div>\n      </div>\n    </div>\n    <div class=\"col-12\">\n      <div class=\"card overflow-auto\" style=\"min-height: 50px;\">\n        <div class=\"card-body\">\n          <h5 class=\"card-title\">one <span>| <small>12/24/2025</small></span></h5>\n          This is a private note\n        </div>\n      </div>\n    </div>\n\n  <div class=\"modal fade\" id=\"myModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"myModalLabel\">\n    <div class=\"modal-dialog\" role=\"document\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n          <h4 class=\"modal-title\" id=\"myModalLabel\"></h4>\n        </div>\n        <div class=\"modal-body\">\n          <div id=\"modal-content\"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n<script>\n\n  $(document).ready(function() {\n    $(\".open-modal-click\").click(function(event) {\n      var clicked = $(this);\n      var target = \"\";\n\n      if (clicked.attr(\"id\") == \"new_note\") {\n        target = \"/systems/980190975/system_notes/new\"\n      } else if (clicked.attr(\"id\") == \"edit_note\") {\n        target = clicked.data(\"url\")\n      }\n  \n      $.ajax({\n        url: target,\n        type: \"GET\",\n        dataType: \"script\",\n        success: function(data) {\n          $(\"#modal-content\").html(data);\n        }\n      });\n    });\n  });\n\n  $(document).off('submit', 'form.form_for_notes').on('submit', 'form.form_for_notes', function(event) {\n    event.preventDefault();\n    var form = $(this);\n    $.ajax({\n      url: form.attr('action'),\n      type: form.attr('method'),\n      data: form.serialize(),\n      dataType: 'script',\n      success: function(data, textStatus, xhr) {\n        if (xhr.status === 204 || xhr.status === 200) {\n          closeSystemNotesModal();\n\n          $('.modal-content').html('');\n          $.ajax({\n            url: '/systems/980190975/system_notes?partial=yes',\n            type: 'GET',\n            success: function(data) {\n              $('#notes_table').html(data);\n            }\n          });\n        }\n      },\n      error: function(xhr) {\n        $('.modal-content').html(xhr.responseText);\n        $('#myModal').show();\n      },\n    });\n  });\n\n  function closeSystemNotesModal() {\n      var modalElement = document.getElementById('myModal');\n      \n      // Use Bootstrap 5 API explicitly\n      if (window.bootstrap && bootstrap.Modal) {\n          var modal = bootstrap.Modal.getInstance(modalElement);\n          if (!modal) {\n              modal = new bootstrap.Modal(modalElement);\n          }\n          modal.hide();\n      } else if (typeof $(modalElement).modal === 'function') {\n          $(modalElement).modal('hide');\n      }\n\n      // Fallback if bootstrap modal doesn't close properly\n      setTimeout(function() {\n        if ($('.modal-backdrop').length > 0) {\n          $('.modal-backdrop').remove();\n          $('body').removeClass('modal-open');\n          $('body').css('overflow', '');\n          $('body').css('padding-right', '');\n        }\n      }, 500);\n  }\n\n</script>\n\n    </div>\n    \n  </section>\n\n<script>\n  $(document).ready(function() {\n    var icon1 = parseInt($('#icon1').data('value'));\n    var icon2 = parseInt($('#icon2').data('value'));\n    var ratio = icon1 / icon2;\n  \n    $('#icon1').css({\n      'font-size': ratio + 'em'\n    });    \n  });\n</script>\n\n    </main>\n    \n  </body>\n\n</html>\n".
rails test test/integration/system_notes_visibility_test.rb:88
F
Failure:
SystemNotesVisibilityTest#test_note_author_can_see_their_own_private_note [/app/test/integration/system_notes_visibility_test.rb:74]:
Expected /This\ is\ a\ private\ note/ to not match "<!DOCTYPE html>\n<html>\n  <head>\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n    \n    \n    \n    <title>Test System System</title>\n    <link rel=\"icon\" type=\"image/x-icon\" href=\"/assets/cc_icon-42def3142b93d68c0270f2fa6450c6679177027439a88be19974bf6e519dee9d.png\" />\n    \n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css\" />\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css\" />\n    <link rel=\"stylesheet\" href=\"/assets/application-2d842fb1ae2dfe531fd2e10c6c58b9d3432a5f865e7f578303750380984a9817.css\" />\n    \n    <script src=\"/assets/application-bbb3e9df6dfa7fe063dd9baa53a645d88e75f6fa15583986a895fb11f76beb20.js\"></script>\n\n    \n    \n    \n  </head>\n  \n  <body  class='toggle-sidebar' >\n    \n      <!-- ======= Header ======= -->\n  <header id=\"header\" class=\"header fixed-top d-flex align-items-center\">\n  \n      <div class=\"d-flex align-items-center justify-content-between\">\n        <a href=\"/\" class=\"logo d-flex align-items-center\">\n          <img src=\"/assets/cc_icon-42def3142b93d68c0270f2fa6450c6679177027439a88be19974bf6e519dee9d.png\" />\n          <span class=\"d-none d-lg-block\">CosmosCreator</span>\n        </a>\n        <i class=\"bi bi-list toggle-sidebar-btn\"></i>\n      </div><!-- End Logo -->\n  \n      <nav class=\"header-nav ms-auto\">\n        <ul class=\"d-flex align-items-center\">\n  \n          <li class=\"nav-item dropdown pe-3\">\n  \n            <a class=\"nav-link nav-profile d-flex align-items-center pe-0\" href=\"#\" data-bs-toggle=\"dropdown\">\n              <span class=\"d-none d-md-block dropdown-toggle ps-2\">Profile</span>\n            </a>\n  \n            <ul class=\"dropdown-menu dropdown-menu-end dropdown-menu-arrow profile\">\n              <li class=\"dropdown-header\">\n                <h6>two@example.com</h6>\n                <span>Member</span>\n              </li>\n              <li>\n                <hr class=\"dropdown-divider\">\n              </li>\n  \n              <li>\n                <a class=\"dropdown-item d-flex align-items-center\" href=\"/profile\">\n                  <i class=\"bi bi-person\"></i>\n                  <span>My Profile</span>\n</a>              </li>\n              <li>\n                <hr class=\"dropdown-divider\">\n              </li>\n  \n              <li>\n                <form class=\"button_to\" method=\"post\" action=\"/users/sign_out\"><input type=\"hidden\" name=\"_method\" value=\"delete\" autocomplete=\"off\" /><button class=\"dropdown-item d-flex align-items-center\" type=\"submit\">\n                  <i class=\"bi bi-box-arrow-right\"></i>\n                  <span>Sign Out</span>\n</button></form>              </li>\n  \n            </ul>\n          </li>\n  \n        </ul>\n      </nav>\n  \n    </header>\n  \n    <!-- ======= Sidebar ======= -->\n    <aside id=\"sidebar\" class=\"sidebar\">\n  \n      <ul class=\"sidebar-nav\" id=\"sidebar-nav\">\n  \n        <li class=\"nav-item\">\n          <a class=\"nav-link \" href=\"/\">\n            <i class=\"bi bi-grid\"></i>\n            <span>Home</span>\n          </a>\n        </li>\n        \n\n          <li class=\"nav-item\">\n            <a class=\"nav-link collapsed\" data-bs-target=\"#sector-nav\" data-bs-toggle=\"collapse\" href=\"#\">\n              <i class=\"bi bi-menu-button-wide\"></i><span>Sectors</span><i class=\"bi bi-chevron-down ms-auto\"></i>\n            </a>\n            <ul id=\"sector-nav\" class=\"nav-content collapse\" data-bs-parent=\"#sidebar-nav\">\n              <li>\n                <a href=\"/sectors\">\n                  <i class=\"bi bi-circle\"></i><span>Sectors List</span>\n</a>              </li>\n            </ul>\n          </li>\n\n        <li class=\"nav-heading\">Misc</li>\n  \n        <li class=\"nav-item\">\n          <a class=\"nav-link collapsed\" href=\"/profile\">\n            <i class=\"bi bi-person\"></i>\n            <span>Profile</span>\n</a>        </li>\n      </ul>\n  \n    </aside><!-- End Sidebar-->\n\n    \n    <main id=\"main\" class=\"main\">\n      \n<style>\n  thead {\n    position: sticky;\n    inset-block-start: 0; /* \"top\" */\n    background: #eee;\n    border-bottom: 2px solid #ccc;\n  }\n  \n  table {\n    border-collapse: collapse;\n  }\n\n  html {\n    scroll-padding-top: 70px; /* height of sticky header */\n  }\n\n  .card {min-height: 165px}\n\n</style>\n\n  <div class=\"pagetitle\">\n    <h1>Test System <span>| 9999</span></h1>\n    <nav>\n      <ol class=\"breadcrumb\">\n        <li class=\"breadcrumb-item\"><a href=\"/\">Home</a></li>\n        <li class=\"breadcrumb-item\"><a href=\"/sectors\">Sectors</a></li>\n        <li class=\"breadcrumb-item\"><a href=\"/systems?sector_id=980190962\">Systems</a></li>\n        <li class=\"breadcrumb-item\"><a href=\"/hex_system/hexmap?sector_id=980190962\">Hexmap</a></li>\n      </ol>\n    </nav>\n  </div>\n  \n  <section class='section dashboard'>\n    <div id=\"row1\" class='row'>\n      \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Starport <span>| Excellent</span></h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <h6>Refined Fuel, Advanced Repair, Advanced Shipyard</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Planet Size <span>| Asteroid Belt</span></h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"card-icon rounded-circle d-flex flex-column align-items-center justify-content-center mx-5\">\n                  <i id=\"icon1\" class=\"bi bi-globe\" data-value=\"0\"></i>\n                  <h6>Test System</h6>\n                </div>\n                <div class=\"d-flex align-items-center mx-1\">\n                  <h3>VS</h3>\n                </div>\n                <div class=\"card-icon rounded-circle d-flex flex-column align-items-center justify-content-center mx-5\">\n                  <i id=\"icon2\" class=\"bi bi-globe\" data-value=\"12000\"></i>\n                  <h6>Earth</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Environment</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <h6><strong>Atmo:</strong> Vacuum - Requires Vacc Suit</h6>\n                  <h6><strong>Hydro:</strong> Desert World - 5%</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Population</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <h6><strong>Permanent Population:</strong> None</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Society</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>Gov:</strong> No Government Structure</h6>\n                    <h6><strong>Law:</strong> Lawless</h6>\n                    <h6><strong>Tech:</strong> Neolithic</h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Faction</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>Faction: </strong></h6>\n                    <p class=\"text-muted small\"></p>\n                    <h6><strong>Bases: </strong></h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Traits</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6></h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>    \n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>System Elements</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>Asteroid Belts:</strong> 0</h6>\n                    <h6><strong>Gas Giants:</strong> 0</h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>    \n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Travel Advisory</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>None:</strong>  No Major Listed Concerns</h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div> \n\n      <div class=\"btn-group col-lg-6 offset-lg-3\" role=\"group\">\n      </div>\n    \n    </div>\n    \n    <div id=\"notes_table\" class='row py-5'>\n        <div class=\"pagetitle\">\n    <h1>Notes <span>| \n</span></h1>\n  </div>\n  \n    <div class=\"col-12\">\n      <div class=\"card overflow-auto\" style=\"min-height: 50px;\">\n        <div class=\"card-body\">\n          <h5 class=\"card-title\">one <span>| <small>12/24/2025</small></span></h5>\n          This is a public note\n        </div>\n      </div>\n    </div>\n    <div class=\"col-12\">\n      <div class=\"card overflow-auto\" style=\"min-height: 50px;\">\n        <div class=\"card-body\">\n          <h5 class=\"card-title\">one <span>| <small>12/24/2025</small></span></h5>\n          This is a private note\n        </div>\n      </div>\n    </div>\n    <div class=\"col-12\">\n      <div class=\"card overflow-auto\" style=\"min-height: 50px;\">\n        <div class=\"card-body\">\n          <h5 class=\"card-title\">two <span>| <small>12/24/2025</small></span></h5>\n          Other user private note\n        </div>\n      </div>\n    </div>\n\n  <div class=\"modal fade\" id=\"myModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"myModalLabel\">\n    <div class=\"modal-dialog\" role=\"document\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n          <h4 class=\"modal-title\" id=\"myModalLabel\"></h4>\n        </div>\n        <div class=\"modal-body\">\n          <div id=\"modal-content\"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n<script>\n\n  $(document).ready(function() {\n    $(\".open-modal-click\").click(function(event) {\n      var clicked = $(this);\n      var target = \"\";\n\n      if (clicked.attr(\"id\") == \"new_note\") {\n        target = \"/systems/980190976/system_notes/new\"\n      } else if (clicked.attr(\"id\") == \"edit_note\") {\n        target = clicked.data(\"url\")\n      }\n  \n      $.ajax({\n        url: target,\n        type: \"GET\",\n        dataType: \"script\",\n        success: function(data) {\n          $(\"#modal-content\").html(data);\n        }\n      });\n    });\n  });\n\n  $(document).off('submit', 'form.form_for_notes').on('submit', 'form.form_for_notes', function(event) {\n    event.preventDefault();\n    var form = $(this);\n    $.ajax({\n      url: form.attr('action'),\n      type: form.attr('method'),\n      data: form.serialize(),\n      dataType: 'script',\n      success: function(data, textStatus, xhr) {\n        if (xhr.status === 204 || xhr.status === 200) {\n          closeSystemNotesModal();\n\n          $('.modal-content').html('');\n          $.ajax({\n            url: '/systems/980190976/system_notes?partial=yes',\n            type: 'GET',\n            success: function(data) {\n              $('#notes_table').html(data);\n            }\n          });\n        }\n      },\n      error: function(xhr) {\n        $('.modal-content').html(xhr.responseText);\n        $('#myModal').show();\n      },\n    });\n  });\n\n  function closeSystemNotesModal() {\n      var modalElement = document.getElementById('myModal');\n      \n      // Use Bootstrap 5 API explicitly\n      if (window.bootstrap && bootstrap.Modal) {\n          var modal = bootstrap.Modal.getInstance(modalElement);\n          if (!modal) {\n              modal = new bootstrap.Modal(modalElement);\n          }\n          modal.hide();\n      } else if (typeof $(modalElement).modal === 'function') {\n          $(modalElement).modal('hide');\n      }\n\n      // Fallback if bootstrap modal doesn't close properly\n      setTimeout(function() {\n        if ($('.modal-backdrop').length > 0) {\n          $('.modal-backdrop').remove();\n          $('body').removeClass('modal-open');\n          $('body').css('overflow', '');\n          $('body').css('padding-right', '');\n        }\n      }, 500);\n  }\n\n</script>\n\n    </div>\n    \n  </section>\n\n<script>\n  $(document).ready(function() {\n    var icon1 = parseInt($('#icon1').data('value'));\n    var icon2 = parseInt($('#icon2').data('value'));\n    var ratio = icon1 / icon2;\n  \n    $('#icon1').css({\n      'font-size': ratio + 'em'\n    });    \n  });\n</script>\n\n    </main>\n    \n  </body>\n\n</html>\n".
rails test test/integration/system_notes_visibility_test.rb:54
F
Failure:
SystemNotesVisibilityTest#test_user_with_permission_can_see_only_public_notes [/app/test/integration/system_notes_visibility_test.rb:85]:
Expected /This\ is\ a\ private\ note/ to not match "<!DOCTYPE html>\n<html>\n  <head>\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n    \n    \n    \n    <title>Test System System</title>\n    <link rel=\"icon\" type=\"image/x-icon\" href=\"/assets/cc_icon-42def3142b93d68c0270f2fa6450c6679177027439a88be19974bf6e519dee9d.png\" />\n    \n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css\" />\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css\" />\n    <link rel=\"stylesheet\" href=\"/assets/application-2d842fb1ae2dfe531fd2e10c6c58b9d3432a5f865e7f578303750380984a9817.css\" />\n    \n    <script src=\"/assets/application-bbb3e9df6dfa7fe063dd9baa53a645d88e75f6fa15583986a895fb11f76beb20.js\"></script>\n\n    \n    \n    \n  </head>\n  \n  <body  class='toggle-sidebar' >\n    \n      <!-- ======= Header ======= -->\n  <header id=\"header\" class=\"header fixed-top d-flex align-items-center\">\n  \n      <div class=\"d-flex align-items-center justify-content-between\">\n        <a href=\"/\" class=\"logo d-flex align-items-center\">\n          <img src=\"/assets/cc_icon-42def3142b93d68c0270f2fa6450c6679177027439a88be19974bf6e519dee9d.png\" />\n          <span class=\"d-none d-lg-block\">CosmosCreator</span>\n        </a>\n        <i class=\"bi bi-list toggle-sidebar-btn\"></i>\n      </div><!-- End Logo -->\n  \n      <nav class=\"header-nav ms-auto\">\n        <ul class=\"d-flex align-items-center\">\n  \n          <li class=\"nav-item dropdown pe-3\">\n  \n            <a class=\"nav-link nav-profile d-flex align-items-center pe-0\" href=\"#\" data-bs-toggle=\"dropdown\">\n              <span class=\"d-none d-md-block dropdown-toggle ps-2\">Profile</span>\n            </a>\n  \n            <ul class=\"dropdown-menu dropdown-menu-end dropdown-menu-arrow profile\">\n              <li class=\"dropdown-header\">\n                <h6>two@example.com</h6>\n                <span>Member</span>\n              </li>\n              <li>\n                <hr class=\"dropdown-divider\">\n              </li>\n  \n              <li>\n                <a class=\"dropdown-item d-flex align-items-center\" href=\"/profile\">\n                  <i class=\"bi bi-person\"></i>\n                  <span>My Profile</span>\n</a>              </li>\n              <li>\n                <hr class=\"dropdown-divider\">\n              </li>\n  \n              <li>\n                <form class=\"button_to\" method=\"post\" action=\"/users/sign_out\"><input type=\"hidden\" name=\"_method\" value=\"delete\" autocomplete=\"off\" /><button class=\"dropdown-item d-flex align-items-center\" type=\"submit\">\n                  <i class=\"bi bi-box-arrow-right\"></i>\n                  <span>Sign Out</span>\n</button></form>              </li>\n  \n            </ul>\n          </li>\n  \n        </ul>\n      </nav>\n  \n    </header>\n  \n    <!-- ======= Sidebar ======= -->\n    <aside id=\"sidebar\" class=\"sidebar\">\n  \n      <ul class=\"sidebar-nav\" id=\"sidebar-nav\">\n  \n        <li class=\"nav-item\">\n          <a class=\"nav-link \" href=\"/\">\n            <i class=\"bi bi-grid\"></i>\n            <span>Home</span>\n          </a>\n        </li>\n        \n\n          <li class=\"nav-item\">\n            <a class=\"nav-link collapsed\" data-bs-target=\"#sector-nav\" data-bs-toggle=\"collapse\" href=\"#\">\n              <i class=\"bi bi-menu-button-wide\"></i><span>Sectors</span><i class=\"bi bi-chevron-down ms-auto\"></i>\n            </a>\n            <ul id=\"sector-nav\" class=\"nav-content collapse\" data-bs-parent=\"#sidebar-nav\">\n              <li>\n                <a href=\"/sectors\">\n                  <i class=\"bi bi-circle\"></i><span>Sectors List</span>\n</a>              </li>\n            </ul>\n          </li>\n\n        <li class=\"nav-heading\">Misc</li>\n  \n        <li class=\"nav-item\">\n          <a class=\"nav-link collapsed\" href=\"/profile\">\n            <i class=\"bi bi-person\"></i>\n            <span>Profile</span>\n</a>        </li>\n      </ul>\n  \n    </aside><!-- End Sidebar-->\n\n    \n    <main id=\"main\" class=\"main\">\n      \n<style>\n  thead {\n    position: sticky;\n    inset-block-start: 0; /* \"top\" */\n    background: #eee;\n    border-bottom: 2px solid #ccc;\n  }\n  \n  table {\n    border-collapse: collapse;\n  }\n\n  html {\n    scroll-padding-top: 70px; /* height of sticky header */\n  }\n\n  .card {min-height: 165px}\n\n</style>\n\n  <div class=\"pagetitle\">\n    <h1>Test System <span>| 9999</span></h1>\n    <nav>\n      <ol class=\"breadcrumb\">\n        <li class=\"breadcrumb-item\"><a href=\"/\">Home</a></li>\n        <li class=\"breadcrumb-item\"><a href=\"/sectors\">Sectors</a></li>\n        <li class=\"breadcrumb-item\"><a href=\"/systems?sector_id=980190962\">Systems</a></li>\n        <li class=\"breadcrumb-item\"><a href=\"/hex_system/hexmap?sector_id=980190962\">Hexmap</a></li>\n      </ol>\n    </nav>\n  </div>\n  \n  <section class='section dashboard'>\n    <div id=\"row1\" class='row'>\n      \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Starport <span>| Excellent</span></h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <h6>Refined Fuel, Advanced Repair, Advanced Shipyard</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Planet Size <span>| Asteroid Belt</span></h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"card-icon rounded-circle d-flex flex-column align-items-center justify-content-center mx-5\">\n                  <i id=\"icon1\" class=\"bi bi-globe\" data-value=\"0\"></i>\n                  <h6>Test System</h6>\n                </div>\n                <div class=\"d-flex align-items-center mx-1\">\n                  <h3>VS</h3>\n                </div>\n                <div class=\"card-icon rounded-circle d-flex flex-column align-items-center justify-content-center mx-5\">\n                  <i id=\"icon2\" class=\"bi bi-globe\" data-value=\"12000\"></i>\n                  <h6>Earth</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Environment</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <h6><strong>Atmo:</strong> Vacuum - Requires Vacc Suit</h6>\n                  <h6><strong>Hydro:</strong> Desert World - 5%</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Population</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <h6><strong>Permanent Population:</strong> None</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Society</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>Gov:</strong> No Government Structure</h6>\n                    <h6><strong>Law:</strong> Lawless</h6>\n                    <h6><strong>Tech:</strong> Neolithic</h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Faction</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>Faction: </strong></h6>\n                    <p class=\"text-muted small\"></p>\n                    <h6><strong>Bases: </strong></h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Traits</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6></h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>    \n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>System Elements</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>Asteroid Belts:</strong> 0</h6>\n                    <h6><strong>Gas Giants:</strong> 0</h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>    \n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Travel Advisory</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>None:</strong>  No Major Listed Concerns</h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div> \n\n      <div class=\"btn-group col-lg-6 offset-lg-3\" role=\"group\">\n      </div>\n    \n    </div>\n    \n    <div id=\"notes_table\" class='row py-5'>\n        <div class=\"pagetitle\">\n    <h1>Notes <span>| \n</span></h1>\n  </div>\n  \n    <div class=\"col-12\">\n      <div class=\"card overflow-auto\" style=\"min-height: 50px;\">\n        <div class=\"card-body\">\n          <h5 class=\"card-title\">one <span>| <small>12/24/2025</small></span></h5>\n          This is a public note\n        </div>\n      </div>\n    </div>\n    <div class=\"col-12\">\n      <div class=\"card overflow-auto\" style=\"min-height: 50px;\">\n        <div class=\"card-body\">\n          <h5 class=\"card-title\">one <span>| <small>12/24/2025</small></span></h5>\n          This is a private note\n        </div>\n      </div>\n    </div>\n\n  <div class=\"modal fade\" id=\"myModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"myModalLabel\">\n    <div class=\"modal-dialog\" role=\"document\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n          <h4 class=\"modal-title\" id=\"myModalLabel\"></h4>\n        </div>\n        <div class=\"modal-body\">\n          <div id=\"modal-content\"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n<script>\n\n  $(document).ready(function() {\n    $(\".open-modal-click\").click(function(event) {\n      var clicked = $(this);\n      var target = \"\";\n\n      if (clicked.attr(\"id\") == \"new_note\") {\n        target = \"/systems/980190977/system_notes/new\"\n      } else if (clicked.attr(\"id\") == \"edit_note\") {\n        target = clicked.data(\"url\")\n      }\n  \n      $.ajax({\n        url: target,\n        type: \"GET\",\n        dataType: \"script\",\n        success: function(data) {\n          $(\"#modal-content\").html(data);\n        }\n      });\n    });\n  });\n\n  $(document).off('submit', 'form.form_for_notes').on('submit', 'form.form_for_notes', function(event) {\n    event.preventDefault();\n    var form = $(this);\n    $.ajax({\n      url: form.attr('action'),\n      type: form.attr('method'),\n      data: form.serialize(),\n      dataType: 'script',\n      success: function(data, textStatus, xhr) {\n        if (xhr.status === 204 || xhr.status === 200) {\n          closeSystemNotesModal();\n\n          $('.modal-content').html('');\n          $.ajax({\n            url: '/systems/980190977/system_notes?partial=yes',\n            type: 'GET',\n            success: function(data) {\n              $('#notes_table').html(data);\n            }\n          });\n        }\n      },\n      error: function(xhr) {\n        $('.modal-content').html(xhr.responseText);\n        $('#myModal').show();\n      },\n    });\n  });\n\n  function closeSystemNotesModal() {\n      var modalElement = document.getElementById('myModal');\n      \n      // Use Bootstrap 5 API explicitly\n      if (window.bootstrap && bootstrap.Modal) {\n          var modal = bootstrap.Modal.getInstance(modalElement);\n          if (!modal) {\n              modal = new bootstrap.Modal(modalElement);\n          }\n          modal.hide();\n      } else if (typeof $(modalElement).modal === 'function') {\n          $(modalElement).modal('hide');\n      }\n\n      // Fallback if bootstrap modal doesn't close properly\n      setTimeout(function() {\n        if ($('.modal-backdrop').length > 0) {\n          $('.modal-backdrop').remove();\n          $('body').removeClass('modal-open');\n          $('body').css('overflow', '');\n          $('body').css('padding-right', '');\n        }\n      }, 500);\n  }\n\n</script>\n\n    </div>\n    \n  </section>\n\n<script>\n  $(document).ready(function() {\n    var icon1 = parseInt($('#icon1').data('value'));\n    var icon2 = parseInt($('#icon2').data('value'));\n    var ratio = icon1 / icon2;\n  \n    $('#icon1').css({\n      'font-size': ratio + 'em'\n    });    \n  });\n</script>\n\n    </main>\n    \n  </body>\n\n</html>\n".
rails test test/integration/system_notes_visibility_test.rb:77
.F
Failure:
SystemNotesVisibilityTest#test_public_sector_notes_are_visible_based_on_can_view_system_notes [/app/test/integration/system_notes_visibility_test.rb:111]:
Expected /This\ is\ a\ private\ note/ to not match "<!DOCTYPE html>\n<html>\n  <head>\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n    \n    \n    \n    <title>Test System System</title>\n    <link rel=\"icon\" type=\"image/x-icon\" href=\"/assets/cc_icon-42def3142b93d68c0270f2fa6450c6679177027439a88be19974bf6e519dee9d.png\" />\n    \n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css\" />\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css\" />\n    <link rel=\"stylesheet\" href=\"/assets/application-2d842fb1ae2dfe531fd2e10c6c58b9d3432a5f865e7f578303750380984a9817.css\" />\n    \n    <script src=\"/assets/application-bbb3e9df6dfa7fe063dd9baa53a645d88e75f6fa15583986a895fb11f76beb20.js\"></script>\n\n    \n    \n    \n  </head>\n  \n  <body  class='toggle-sidebar' >\n    \n      <!-- ======= Header ======= -->\n  <header id=\"header\" class=\"header fixed-top d-flex align-items-center\">\n  \n      <div class=\"d-flex align-items-center justify-content-between\">\n        <a href=\"/\" class=\"logo d-flex align-items-center\">\n          <img src=\"/assets/cc_icon-42def3142b93d68c0270f2fa6450c6679177027439a88be19974bf6e519dee9d.png\" />\n          <span class=\"d-none d-lg-block\">CosmosCreator</span>\n        </a>\n        <i class=\"bi bi-list toggle-sidebar-btn\"></i>\n      </div><!-- End Logo -->\n  \n      <nav class=\"header-nav ms-auto\">\n        <ul class=\"d-flex align-items-center\">\n  \n          <li class=\"nav-item dropdown pe-3\">\n  \n            <a class=\"nav-link nav-profile d-flex align-items-center pe-0\" href=\"#\" data-bs-toggle=\"dropdown\">\n              <span class=\"d-none d-md-block dropdown-toggle ps-2\">Profile</span>\n            </a>\n  \n            <ul class=\"dropdown-menu dropdown-menu-end dropdown-menu-arrow profile\">\n              <li class=\"dropdown-header\">\n                <h6>two@example.com</h6>\n                <span>User</span>\n              </li>\n              <li>\n                <hr class=\"dropdown-divider\">\n              </li>\n  \n              <li>\n                <a class=\"dropdown-item d-flex align-items-center\" href=\"/profile\">\n                  <i class=\"bi bi-person\"></i>\n                  <span>My Profile</span>\n</a>              </li>\n              <li>\n                <hr class=\"dropdown-divider\">\n              </li>\n  \n              <li>\n                <form class=\"button_to\" method=\"post\" action=\"/users/sign_out\"><input type=\"hidden\" name=\"_method\" value=\"delete\" autocomplete=\"off\" /><button class=\"dropdown-item d-flex align-items-center\" type=\"submit\">\n                  <i class=\"bi bi-box-arrow-right\"></i>\n                  <span>Sign Out</span>\n</button></form>              </li>\n  \n            </ul>\n          </li>\n  \n        </ul>\n      </nav>\n  \n    </header>\n  \n    <!-- ======= Sidebar ======= -->\n    <aside id=\"sidebar\" class=\"sidebar\">\n  \n      <ul class=\"sidebar-nav\" id=\"sidebar-nav\">\n  \n        <li class=\"nav-item\">\n          <a class=\"nav-link \" href=\"/\">\n            <i class=\"bi bi-grid\"></i>\n            <span>Home</span>\n          </a>\n        </li>\n        \n\n\n        <li class=\"nav-heading\">Misc</li>\n  \n        <li class=\"nav-item\">\n          <a class=\"nav-link collapsed\" href=\"/profile\">\n            <i class=\"bi bi-person\"></i>\n            <span>Profile</span>\n</a>        </li>\n      </ul>\n  \n    </aside><!-- End Sidebar-->\n\n    \n    <main id=\"main\" class=\"main\">\n      \n<style>\n  thead {\n    position: sticky;\n    inset-block-start: 0; /* \"top\" */\n    background: #eee;\n    border-bottom: 2px solid #ccc;\n  }\n  \n  table {\n    border-collapse: collapse;\n  }\n\n  html {\n    scroll-padding-top: 70px; /* height of sticky header */\n  }\n\n  .card {min-height: 165px}\n\n</style>\n\n  <div class=\"pagetitle\">\n    <h1>Test System <span>| 9999</span></h1>\n    <nav>\n      <ol class=\"breadcrumb\">\n        <li class=\"breadcrumb-item\"><a href=\"/\">Home</a></li>\n        <li class=\"breadcrumb-item\"><a href=\"/sectors\">Sectors</a></li>\n        <li class=\"breadcrumb-item\"><a href=\"/systems?sector_id=980190962\">Systems</a></li>\n        <li class=\"breadcrumb-item\"><a href=\"/hex_system/hexmap?sector_id=980190962\">Hexmap</a></li>\n      </ol>\n    </nav>\n  </div>\n  \n  <section class='section dashboard'>\n    <div id=\"row1\" class='row'>\n      \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Starport <span>| Excellent</span></h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <h6>Refined Fuel, Advanced Repair, Advanced Shipyard</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Planet Size <span>| Asteroid Belt</span></h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"card-icon rounded-circle d-flex flex-column align-items-center justify-content-center mx-5\">\n                  <i id=\"icon1\" class=\"bi bi-globe\" data-value=\"0\"></i>\n                  <h6>Test System</h6>\n                </div>\n                <div class=\"d-flex align-items-center mx-1\">\n                  <h3>VS</h3>\n                </div>\n                <div class=\"card-icon rounded-circle d-flex flex-column align-items-center justify-content-center mx-5\">\n                  <i id=\"icon2\" class=\"bi bi-globe\" data-value=\"12000\"></i>\n                  <h6>Earth</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Environment</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <h6><strong>Atmo:</strong> Vacuum - Requires Vacc Suit</h6>\n                  <h6><strong>Hydro:</strong> Desert World - 5%</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Population</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <h6><strong>Permanent Population:</strong> None</h6>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Society</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>Gov:</strong> No Government Structure</h6>\n                    <h6><strong>Law:</strong> Lawless</h6>\n                    <h6><strong>Tech:</strong> Neolithic</h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Faction</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>Faction: </strong></h6>\n                    <p class=\"text-muted small\"></p>\n                    <h6><strong>Bases: </strong></h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Traits</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6></h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>    \n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>System Elements</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>Asteroid Belts:</strong> 0</h6>\n                    <h6><strong>Gas Giants:</strong> 0</h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div>    \n  \n      <div class='col-xxl-4 col-md-6'>\n        <div class='card'>\n          <div class='card-body'>\n            <h5 class='card-title'>Travel Advisory</h5>\n              <div class=\"d-flex justify-content-around\">\n                <div class=\"d-flex flex-column align-items-center justify-content-center\">\n                  <div>\n                    <h6><strong>None:</strong>  No Major Listed Concerns</h6>\n                  </div>\n                </div>\n              </div>\n          </div>\n        </div>\n      </div> \n\n      <div class=\"btn-group col-lg-6 offset-lg-3\" role=\"group\">\n      </div>\n    \n    </div>\n    \n    <div id=\"notes_table\" class='row py-5'>\n        <div class=\"pagetitle\">\n    <h1>Notes <span>| \n</span></h1>\n  </div>\n  \n    <div class=\"col-12\">\n      <div class=\"card overflow-auto\" style=\"min-height: 50px;\">\n        <div class=\"card-body\">\n          <h5 class=\"card-title\">one <span>| <small>12/24/2025</small></span></h5>\n          This is a public note\n        </div>\n      </div>\n    </div>\n    <div class=\"col-12\">\n      <div class=\"card overflow-auto\" style=\"min-height: 50px;\">\n        <div class=\"card-body\">\n          <h5 class=\"card-title\">one <span>| <small>12/24/2025</small></span></h5>\n          This is a private note\n        </div>\n      </div>\n    </div>\n\n  <div class=\"modal fade\" id=\"myModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"myModalLabel\">\n    <div class=\"modal-dialog\" role=\"document\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n          <h4 class=\"modal-title\" id=\"myModalLabel\"></h4>\n        </div>\n        <div class=\"modal-body\">\n          <div id=\"modal-content\"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n<script>\n\n  $(document).ready(function() {\n    $(\".open-modal-click\").click(function(event) {\n      var clicked = $(this);\n      var target = \"\";\n\n      if (clicked.attr(\"id\") == \"new_note\") {\n        target = \"/systems/980190979/system_notes/new\"\n      } else if (clicked.attr(\"id\") == \"edit_note\") {\n        target = clicked.data(\"url\")\n      }\n  \n      $.ajax({\n        url: target,\n        type: \"GET\",\n        dataType: \"script\",\n        success: function(data) {\n          $(\"#modal-content\").html(data);\n        }\n      });\n    });\n  });\n\n  $(document).off('submit', 'form.form_for_notes').on('submit', 'form.form_for_notes', function(event) {\n    event.preventDefault();\n    var form = $(this);\n    $.ajax({\n      url: form.attr('action'),\n      type: form.attr('method'),\n      data: form.serialize(),\n      dataType: 'script',\n      success: function(data, textStatus, xhr) {\n        if (xhr.status === 204 || xhr.status === 200) {\n          closeSystemNotesModal();\n\n          $('.modal-content').html('');\n          $.ajax({\n            url: '/systems/980190979/system_notes?partial=yes',\n            type: 'GET',\n            success: function(data) {\n              $('#notes_table').html(data);\n            }\n          });\n        }\n      },\n      error: function(xhr) {\n        $('.modal-content').html(xhr.responseText);\n        $('#myModal').show();\n      },\n    });\n  });\n\n  function closeSystemNotesModal() {\n      var modalElement = document.getElementById('myModal');\n      \n      // Use Bootstrap 5 API explicitly\n      if (window.bootstrap && bootstrap.Modal) {\n          var modal = bootstrap.Modal.getInstance(modalElement);\n          if (!modal) {\n              modal = new bootstrap.Modal(modalElement);\n          }\n          modal.hide();\n      } else if (typeof $(modalElement).modal === 'function') {\n          $(modalElement).modal('hide');\n      }\n\n      // Fallback if bootstrap modal doesn't close properly\n      setTimeout(function() {\n        if ($('.modal-backdrop').length > 0) {\n          $('.modal-backdrop').remove();\n          $('body').removeClass('modal-open');\n          $('body').css('overflow', '');\n          $('body').css('padding-right', '');\n        }\n      }, 500);\n  }\n\n</script>\n\n    </div>\n    \n  </section>\n\n<script>\n  $(document).ready(function() {\n    var icon1 = parseInt($('#icon1').data('value'));\n    var icon2 = parseInt($('#icon2').data('value'));\n    var ratio = icon1 / icon2;\n  \n    $('#icon1').css({\n      'font-size': ratio + 'em'\n    });    \n  });\n</script>\n\n    </main>\n    \n  </body>\n\n</html>\n".
rails test test/integration/system_notes_visibility_test.rb:100
.
Finished in 6.835631s, 0.8778 runs/s, 4.3888 assertions/s.
6 runs, 30 assertions, 4 failures, 0 errors, 0 skips